<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3: Week7</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <!--<script type="text/javascript" src="Assignment2B.js"></script>-->
    <style type="text/css">
        #mychart {
            background-color: white;
            color: red;
        }
    </style>
</head>
<body>
<div class="kati">
    <svg width="1000" height="800" id="mychart"></svg>
</div>

<script type="text/javascript">
    (function () {
        var w = 1000;
        var h = 800;
        const padding = 50;

        //Create SVG element
        var svg = d3.select("#mychart");

        //Data
        d3.json("counts2003.json", function (data) {
            console.log(data);

            data.forEach(function (item) {
                item.prostitution = parseInt(item.prostitution);
                item.vehicleThefts = parseInt(item.vehicleThefts);
                item.totalCrimes = parseInt(item.totalCrimes);
            });

            var xScale = d3.scale.linear()
                .domain([0, d3.max(data, function (data) {
                    return data.prostitution;
                })])
                .range([padding, w-padding]);


            var myDomain = d3.scale.linear().domain([0, d3.max(data, function (data) {
                return data.vehicleThefts;
            })]);
            var yScale = myDomain.range([h-padding, padding]);


            const factor = 0.009;
            const maxRadius = Math.sqrt(w*h*factor/Math.PI);
            var rScale = d3.scale.linear()
                .domain([0, d3.max(data, function (data) {
                    return data.totalCrimes;
                })])
                .range([0, maxRadius]);


            var circles = svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (data) {
                    return xScale(data.prostitution);
                })
                .attr("cy", function (data) {
                    return yScale(data.vehicleThefts);
                })
                .attr("r", function (data) {
                    return rScale(data.totalCrimes);
                })
                .attr('opacity', 0.3);


            //Add  labels
            var a = svg.selectAll("text.label");
            var b = a.data(data);
            var c = b.enter();
            var d = c.append("text");
            var e = d.text(function(data) {
                return data.district;
            })
                .attr("x", function(data) {
                    return xScale(data.prostitution);
                })
                .attr("y", function(data) {
                    return yScale(data.vehicleThefts);
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", "10px")
                .attr("fill", "#483D8B")
                .attr('opacity', 1)

            //Define X axis
            var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom")
                .ticks(12);

            //Define Y axis
            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left")
                .ticks(8);

            //Create X axis
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - padding - 6) + ")")
                .call(xAxis);


            //Create Y axis
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding + ",0)")
                .call(yAxis);

            //Add text
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - padding + 15)
                .attr("x", 0 - (h / 2))
                .attr("dy", "4em")
                .style("text-anchor", "middle")
                .text("vehicle theft");

            // Add the text label for the x axis
            svg.append("text").attr("transform", "translate(" + (w / 2) + "," + (h - 15) + ")").style("text-anchor", "middle").text("prostitution");



        });

    })()

</script>
</body>


</html>